<div class="inventory-adjustments-view">
  <div class="ibox">
    <div class="ibox-title">
      <h3>
        <%= htmlWebpackPlugin.options.general.adjustments %>
      </h3>
    </div>
    <div class="ibox-content">
      <div ng-show="step == 'list'">
        <a 
            ng-disabled="(!currentUser.canAdmin || !currentUser.canManage) && isEmpty" 
            class="btn btn-secondary-left" 
            href="{{downloadLink}}" 
            download="<%= htmlWebpackPlugin.options.files.movement_report %>">
          <%= htmlWebpackPlugin.options.general.download %>
        </a>
        <div class="form-group pull-right"">
          <!-- ENTRY TYPES: PISO, BLA BLA BLA -->
          <button 
              type=" button" 
              ng-repeat="entryType in entryTypes" 
              class="btn" 
              ng-class="(entryType.value == selectedType)? 'btn-today' : 'btn-secondary-left'" 
              ng-click="typeChange(entryType.value)">
            {{entryType.label}}
          </button>
        </div>
        
        <br>
        <br>
        
        <button 
            type="button" 
            class="btn btn-success pull-right" 
            style="margin-right: 10px" 
            ng-click="step = 'new'">
          <%= htmlWebpackPlugin.options.general.add %>
        </button>

        <p class="input-group pull-left" style="width: 25%; margin-right: 1rem;">
          <span class="input-group-btn">
            <button 
                type="button" 
                class="btn btn-calendar" 
                ng-click="openStartDate()">
              <%= htmlWebpackPlugin.options.date.from %> 
              <i class="glyphicon glyphicon-calendar"></i>
            </button>
          </span>
          <input 
              name="startDate" 
              type="text" 
              class="form-control" 
              uib-datepicker-popup="{{format}}" 
              ng-model="startDate" 
              is-open="startDatePopup.opened" 
              datepicker-options="startDateOptions" 
              required="true" 
              close-text="<%= htmlWebpackPlugin.options.general.close %>" 
              current-text="<%= htmlWebpackPlugin.options.date.today %>" 
              clear-text="<%= htmlWebpackPlugin.options.general.clear %>" 
              alt-input-formats="altInputFormats" 
              ng-change="startDateChange()" />
        </p>

        <p class="input-group" style="width: 25%; margin-right: 1rem;">
          <span class="input-group-btn">
            <button 
                type="button" 
                class="btn btn-calendar" 
                ng-click="openEndDate()">
              <%= htmlWebpackPlugin.options.date.to %> 
              <i class="glyphicon glyphicon-calendar"></i>
            </button>
          </span>
          <input 
              name="endDate" 
              type="text" 
              class="form-control" 
              uib-datepicker-popup="{{format}}" 
              ng-model="endDate" 
              is-open="endDatePopup.opened" 
              datepicker-options="endDateOptions" 
              required="true" 
              close-text="<%= htmlWebpackPlugin.options.general.close %>" 
              current-text="<%= htmlWebpackPlugin.options.date.today %>" 
              clear-text="<%= htmlWebpackPlugin.options.general.clear %>" 
              alt-input-formats="altInputFormats" 
              ng-change="endDateChange()" />
        </p>

        <div>
          <div 
              class="table-filter" 
              ng-if="ready" 
              ng-dropdown-multiselect="" 
              options="availableWarehousesList" 
              selected-model="warehouseList" 
              extra-settings="dropdownSettings" 
              events="warehouseDropdownEvents" 
              translation-texts="warehouseDropdownTranslations">
          </div>
        </div>

        <br>
        <br>
        <br>
        <br>
        
        <div>
          <table 
              ng-if="ready" 
              id="movements-table" 
              class="table table-striped table-hover" 
              datatable="" 
              dt-options="tableOptions" 
              dt-columns="tableColumns">
          </table>
        </div>
      </div>

      <div ng-show="step == 'new'">
        <div 
            class="pull-right" 
            ng-if="!inventory || !productObj.color">
          <%= htmlWebpackPlugin.options.inventory.select_product %>
        </div>
        <div>
          <label><%= htmlWebpackPlugin.options.general.warehouse %></label>
          <select 
              name="warehouses" 
              id="repeatWareHouses" 
              ng-model="warehouse" 
              ng-change="updateWarehouse(warehouse)">
            <option 
                ng-repeat="warehouse in warehouses" 
                value="{{warehouse}}">
              {{warehouse.name}}
            </option>
          </select>
          
          <br>
          <br>

        </div>

        <div class="form-group">
          <label>
            <%= htmlWebpackPlugin.options.general.type %>
          </label>
          <select 
              name="type" 
              ng-model="productObj.type" 
              class="form-control" 
              ng-change="updateType(selectedTypeCap, productObj)" 
              required>
            <%= htmlWebpackPlugin.options.inventory.product_types %>
          </select>
          <small 
              class="error-message" 
              ng-if="productForm.$validated && productForm.type.$error.required">
            <%= htmlWebpackPlugin.options.general.required_field %>
          </small>
        </div>
        <div class="form-group" ng-show="selectedType == 'piso'">
          <label ng-hide="showSpinner">
            <%= htmlWebpackPlugin.options.general.color %>
          </label>
          <input 
              ng-hide="showSpinner" 
              type="text" 
              name="color" 
              ng-model="productObj.color" 
              id="color" 
              ng-disabled="!productObj.type" 
              class="form-control" 
              value="{{modaa}}" 
              required="" 
              uib-typeahead="color.label for color in productObj.colors | filter: $viewValue | limitTo:12" 
              typeahead-editable="false" 
              typeahead-on-select="updateColor($item, piso)">
          <small 
              ng-hide="showSpinner" 
              class="error-message" 
              ng-if="productForm.$validated && productForm.color.$error.required">
            <%= htmlWebpackPlugin.options.general.required_field %>
          </small>
          <img 
              ng-show="showSpinner" 
              class="spinner-img" 
              src="img/spinner.gif" />
        </div>
        
        <div class="form-group" ng-show="selectedType == 'plus'">
          <label ng-hide="showSpinner">
            <%= htmlWebpackPlugin.options.general.molding %>
          </label>
          <input 
              ng-hide="showSpinner" 
              type="text" 
              name="color" 
              ng-model="productObj.color" 
              id="color" 
              ng-disabled="!productObj.type" 
              class="form-control" 
              value="{{modaa}}" 
              required="" 
              uib-typeahead="color.label for color in productObj.colors | filter: $viewValue | limitTo:12" 
              typeahead-editable="false" 
              typeahead-on-select="updateColor($item, piso)">
          <small 
              ng-hide="showSpinner" 
              class="error-message" 
              ng-if="productForm.$validated && productForm.color.$error.required">
            <%= htmlWebpackPlugin.options.general.required_field %>
          </small>
          <img 
              ng-show="showSpinner" 
              class="spinner-img" 
              src="img/spinner.gif">
        </div>
        <div ng-if="warehouse && inventory && productObj.color">

          <br>
          <br>

          <div 
              ng-show="adjustment>=0" 
              class="pull-right">
            <%= htmlWebpackPlugin.options.general.difference %>
              : {{adjustment - inventory.quantity}}
          </div>
          <div>
            <%= htmlWebpackPlugin.options.general.existance %>
            : {{inventory.quantity}}
          </div>
          <br>
          <div>
            <%= htmlWebpackPlugin.options.general.new_value %>: 
            <input 
                type="number" 
                name="quantity" 
                min="0" 
                ng-model="adjustment" 
                class="form-control" 
                required>
            <small 
                class="error-message" 
                ng-if="validated && !adjustment">
              <%= htmlWebpackPlugin.options.general.error_negative %>
            </small>
            <small 
                class="error-message" 
                ng-if="validated && adjustment<0">
              <%= htmlWebpackPlugin.options.general.error_negative %>
            </small>
          </div>
          <br>
          <div class="form-group">
            <label>
              <%= htmlWebpackPlugin.options.general.reason %>
            </label>
            <input 
                type="text" 
                name="description" 
                ng-model="description" 
                class="form-control" 
                required>
            <small 
                class="error-message" 
                ng-if="validated && !description">
              <%= htmlWebpackPlugin.options.general.required_field %>
            </small>
          </div>
          
          <br>
          
          <button 
              type="button" 
              ng-click="save(adjustment, description)" 
              class="btn btn-primary">
            <%= htmlWebpackPlugin.options.general.save %>
          </button>
        </div>
        <div ng-if="!inventory && loaded">
          <br>
          <%= htmlWebpackPlugin.options.inventory.empty_warehouse %>
        </div>
        
        <br>
        
        <button 
            type="button" 
            ng-click="cancel()" 
            class="btn btn-secondary">
          <%= htmlWebpackPlugin.options.general.back %>
        </button>
      </div>
    </div>
  </div>
</div>