<div class="inventory-adjustments-view">
	<div class="ibox">
		<div class="ibox-title"><h3>Ajustes</h3></div>
		<div class="ibox-content">

			<div ng-show="step == 'list'">
				<a ng-disabled="(!currentUser.canAdmin || !currentUser.canManage) && isEmpty" class="btn btn-secondary-left" href="{{downloadLink}}" download="reporte_movimientos.xlsx">Descargar reporte</a>
				<div class="form-group pull-right" ">
           			<button type="button" ng-repeat="entryType in entryTypes" class="btn" ng-class="(entryType.value == selectedType)? 'btn-today' : 'btn-secondary-left'" ng-click="typeChange(entryType.value)">{{entryType.label}}</button>
       	 		</div>
      			<br><br>
				<button type="button" class="btn btn-success pull-right" style="margin-right: 10px" ng-click="step = 'new'">Agregar</button>
      			
				<p class="input-group pull-left" style="width: 25%; margin-right: 1rem;">
					<span class="input-group-btn">
						<button type="button" class="btn btn-calendar" ng-click="openStartDate()">Desde <i class="glyphicon glyphicon-calendar"></i></button>
					</span>
					<input name="startDate" type="text" class="form-control" uib-datepicker-popup="{{format}}" ng-model="startDate" is-open="startDatePopup.opened" datepicker-options="startDateOptions" required="true" close-text="Cerrar" current-text="Hoy" clear-text="Limpiar" alt-input-formats="altInputFormats" ng-change="startDateChange()">
				</p>

				<p class="input-group" style="width: 25%; margin-right: 1rem;">
					<span class="input-group-btn">
						<button type="button" class="btn btn-calendar" ng-click="openEndDate()">Hasta <i class="glyphicon glyphicon-calendar"></i></button>
					</span>
					<input name="endDate" type="text" class="form-control" uib-datepicker-popup="{{format}}" ng-model="endDate" is-open="endDatePopup.opened" datepicker-options="endDateOptions" required="true" close-text="Cerrar" current-text="Hoy" clear-text="Limpiar" alt-input-formats="altInputFormats" ng-change="endDateChange()">
				</p>

				<div>
					<div class="table-filter" ng-if="ready" ng-dropdown-multiselect options="availableWarehousesList" selected-model="warehouseList" extra-settings="dropdownSettings" events="warehouseDropdownEvents" translation-texts="warehouseDropdownTranslations"></div>
				</div>
				<br>
				<br>
				<br>
				<br>

				<div>
					<table ng-if="ready" id="movements-table" class="table table-striped table-hover" datatable dt-options="tableOptions" dt-columns="tableColumns"></table>
				</div>	
			</div>

			<div ng-show="step == 'new'">
				<div class="pull-right" ng-if="!inventory || !productObj.color">Seleccione un producto de un almacen</div>

				<div>
					<label>Almacén:</label>
					<label>Almacén:</label>

					<select name="warehouses" id="repeatWareHouses" ng-model="warehouse" ng-change="updateWarehouse(warehouse)">
						<option ng-repeat="warehouse in warehouses" value="{{warehouse}}">{{warehouse.name}}</option>
					</select>
					<br><br>
				</div>

				<div class="form-group">
					<label>Tipo</label>
					<select name="type" ng-model="productObj.type" class="form-control" ng-change="updateType(selectedTypeCap, productObj)" required>
						<option value="Laminados">Laminado</option>
						<option value="Vinil">Vinil</option>
						<option value="Ingenieria">Ingeniería</option>
					</select>
					<small class="error-message" ng-if="productForm.$validated && productForm.type.$error.required">Campo requerido</small>
				</div>

				<div class="form-group" ng-show="selectedType == 'piso'">
					<label ng-hide="showSpinner">Color</label>
					<input ng-hide="showSpinner" type="text" name="color" ng-model="productObj.color" id="color" ng-disabled="!productObj.type" class="form-control" value="{{modaa}}" required uib-typeahead="color.label for color in productObj.colors | filter: $viewValue | limitTo:12" typeahead-editable="false" typeahead-on-select="updateColor($item, piso)">
					<small ng-hide="showSpinner" class="error-message" ng-if="productForm.$validated && productForm.color.$error.required">Campo requerido</small>
					<img ng-show="showSpinner" class="spinner-img" src="img/spinner.gif">
				</div>

					<div class="form-group" ng-show="selectedType == 'plus'">
					<label ng-hide="showSpinner">Moldura</label>
					<input ng-hide="showSpinner" type="text" name="color" ng-model="productObj.color" id="color" ng-disabled="!productObj.type" class="form-control" value="{{modaa}}" required uib-typeahead="color.label for color in productObj.colors | filter: $viewValue | limitTo:12" typeahead-editable="false" typeahead-on-select="updateColor($item, piso)">
					<small ng-hide="showSpinner" class="error-message" ng-if="productForm.$validated && productForm.color.$error.required">Campo requerido</small>
					<img ng-show="showSpinner" class="spinner-img" src="img/spinner.gif">
				</div>



				<div ng-if="warehouse && inventory && productObj.color">
					<br><br>
					<div ng-show="adjustment>=0" class="pull-right">Diferencia: {{adjustment - inventory.quantity}}</div>
					<div>Existencias: {{inventory.quantity}}</div>
					<br>
					<div>Nuevo valor: 
						<input type="number" name="quantity" min="0" ng-model="adjustment" class="form-control" required>
						<small class="error-message" ng-if="validated && !adjustment">Valor obligatorio no negativo</small>
						<small class="error-message" ng-if="validated && adjustment<0">El valor no puede ser negativo</small>
					</div>

					<br>
					<div class="form-group">
						<label>Justificación</label>
						<input type="text" name="description" ng-model="description" class="form-control" required>
						<small class="error-message" ng-if="validated && !description">Campo requerido</small>
					</div>
					<br>

					<button type="button" ng-click="save(adjustment, description)" class="btn btn-primary">Guardar</button>

				</div>
				
				<div ng-if="!inventory && loaded"><br>No hay existencias el almacen seleccionado</div>
				<br>
				<button type="button" ng-click="cancel()" class="btn btn-secondary">Regresar</button>

			</div>
		</div>
	</div>
</div>
